<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Smart Bus [EXIST]</title>
  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="/stylesheets/bootstrap.min.css">
  <!-- Optional theme -->
  <link rel="stylesheet" href="/stylesheets/bootstrap-theme.min.css">
  <script src="/stylesheets/jquery-3.1.0.min.js"></script>
  <script src="/libs/exceed.lib.js"></script>
  <link rel="stylesheet" href="/leftcolumn.css">
  <link rel="stylesheet" href="/CenterColumn.css">
  <link rel="stylesheet" href="/rightcolumn.css">
</head>

<body>

  <div class="row">
    <br/>
    <div id = "leftColumn" class="col-sm-3 text-center">
      <div id = "time" class="panel panel-primary">
        <div id="time-body" class="panel-body">



        </div>
      </div>
      <br/>

      <div id = "panel-enter" class="panel panel-success text-center">
        <div id "panelHeadEnter" class="panel-heading"><button class='btn btn-success' id = "enterButton" >ENTER</button></div>
        <div id="panel-enter-body" class="panel-body">0</div>
      </div>
      <br/>
      <div id = "panel-leave" class="panel panel-danger">
        <div id="panelHead" class="panel-heading"><button class = 'btn btn-danger' id = "leaveButton">LEAVE</button></div>
        <div id="panel-leave-body" class="panel-body">0</div>
      </div>

    </div>


    <div id = "centerColumn" class="col-sm-6">
      <!-- <button onclick="entering()">asfdsg</button>
            <button onclick="leaving()">asfdsg</button> -->
      <div class="row">
        <div class="col-xs-5 col-md-5">
          <div class="row">
            <div class="col-xs-6 col-md-6">
              <button type="button" class=" btn btn-success box" id="btn1">1</button>
              <button type="button" class=" btn btn-success box" id="btn5">5</button>
              <button type="button" class=" btn btn-success box" id="btn9">9</button>
              <button type="button" class=" btn btn-success box" id="btn13">13</button>
              <button type="button" class=" btn btn-success box" id="btn17">17</button>
            </div>
            <div class="col-xs-6 col-md-6">
              <button type="button" class=" btn btn-success box" id="btn2">2</button>
              <button type="button" class=" btn btn-success box" id="btn6">6</button>
              <button type="button" class=" btn btn-success box" id="btn10">10</button>
              <button type="button" class=" btn btn-success box" id="btn14">14</button>
              <button type="button" class=" btn btn-success box" id="btn18">18</button>
            </div>
          </div>
        </div>
        <div  class="col-xs-2 col-md-2">

          <img id="buspic" src="images/bus-2.png" height="60" width="60"></img>

        </div>
        <div class="col-xs-5 col-md-5">
          <div class="row">
            <div class="col-xs-6 col-md-6">
              <button type="button" class=" btn btn-success box" id="btn3">3</button>
              <button type="button" class=" btn btn-success box" id="btn7">7</button>
              <button type="button" class=" btn btn-success box" id="btn11">11</button>
              <button type="button" class=" btn btn-success box" id="btn15">15</button>
              <button type="button" class=" btn btn-success box" id="btn19">19</button>
            </div>
            <div class="col-xs-6 col-md-6">
              <button type="button" class=" btn btn-success box" id="btn4">4</button>
              <button type="button" class=" btn btn-success box" id="btn8">8</button>
              <button type="button" class=" btn btn-success box" id="btn12">12</button>
              <button type="button" class=" btn btn-success box" id="btn16">16</button>
              <button type="button" class=" btn btn-primary box" id="btnVIP">VIP</button>
            </div>
          </div>
        </div>
      </div>




      <div class="panel panel-success">
        <div id="panel" class="panel-heading">Remaining</div>
        <div id="footer" class="panel-footer" >
          <div class="progress" id="test">
            <div class="progress-bar progress-bar-success progress-bar-striped active" role="progressbar"
            aria-valuenow="20" aria-valuemin="0" aria-valuemax="20" style="width:100%" id="progressRemain">
            <div id="remain">20</div>
          </div>
        </div>
      </div>
    </div>

  </div>

  <div id="rightColumn" class="col-sm-3">
    <div class="row">
      <div id="container">
        <div class="panel panel-success">
          <div class="panel-heading">HISTORY</div>
          <div class="panel-body">
            <ul class="tabs" id="chat-list"></ul>
            <br />
            <!-- <div>
            <input class="form-control" id="message" />
          </div> -->

        </div>
      </div>
    </div>
  </div>





</div>
</div>


<script>
$(function(){


  var Enter = $('#enterButton');
  var Leave = $('#leaveButton');
  var j =0;
  var k = 0;

  Enter.click(function(){


    console.log(j++);

    // document.getElementById('#panel-enter-body').innerHTML = j ;
    $('#panel-enter-body').html(j);
  });

  Leave.click(function(){


    console.log(k++);

    // document.getElementById('#panel-enter-body').innerHTML = j ;
    $('#panel-leave-body').html(k);
  });




  (function () {
    function checkTime(i) {
      return (i < 10) ? "0" + i : i;
    }

    function startTime() {
      var today = new Date(),
      h = checkTime(today.getHours()),
      m = checkTime(today.getMinutes()),
      s = checkTime(today.getSeconds());
      document.getElementById('time-body').innerHTML = "<p id = \"textTime\">"+h + ":" + m + ":" + s + "</p>";
      t = setTimeout(function () {
        startTime()
      }, 500);
    }
    startTime();
  })();

})




////////////////////////////////////////



var vip = $("#btnVIP");
var seat = [$("#btn1"),$("#btn2"),$("#btn3"),$("#btn4"),$("#btn5"),
$("#btn6"),$("#btn7"),$("#btn8"),$("#btn9"),$("#btn10"),
$("#btn11"),$("#btn12"),$("#btn13"),$("#btn14"),$("#btn15"),
$("#btn16"),$("#btn17"),$("#btn18"),$("#btn19"),$("#btn20")];



var count = 0;
var passenger = [];
var list = '';


vip.click(function(){
  if(vip.hasClass("btn-primary")){
    alert("VIP has benn reserved!");
    vip.removeClass("btn-primary");
    vip.addClass("disabled");
    count++;
    $("#remain").text(20-$("#footer").val()-count);
    $("#progressRemain").val(20-$("#footer").val()-count);
    var remaining = 20-$("#footer").val()-count;
    $("#progressRemain").css('width', remaining*5+'%').attr('aria-valuenow', remaining);
    console.log(j++);

    // document.getElementById('#panel-enter-body').innerHTML = j ;
    $('#panel-enter-body').html(j);

    var message = PassengerEnter.val(); //Get message from html element
    var date = new Date();
    var now = date.toUTCString();
    $("#chat-list").append("<li><span class = \"indicator success\"> VIP RESERVED : "+now +"</span>t</li>");


    if(remaining <= 5){
      $("#progressRemain").removeClass("progress-bar-warning");
      $("#progressRemain").addClass("progress-bar-danger");
      $("#buspic").attr("src", "images/bus-1.png");

    }else if(remaining <= 10){
      $("#progressRemain").removeClass("progress-bar-success");
      $("#progressRemain").addClass("progress-bar-warning");
      $("#buspic").attr("src", "images/bus-3.png");


    }

  }else if(vip.hasClass("disabled")){
    alert("VIP has benn canceled!");
    vip.removeClass("disabled");
    vip.addClass("btn-primary");
    count--;
    $("#remain").text(20-$("#footer").val()-count);
    var remaining = 20-$("#footer").val()-count;
    $("#progressRemain").css('width', remaining*5+'%').attr('aria-valuenow', remaining);
    console.log(j--);

    // document.getElementById('#panel-enter-body').innerHTML = j ;
    $('#panel-enter-body').html(j);

    if(remaining > 10){
      $("#progressRemain").removeClass("progress-bar-warning");
      $("#progressRemain").addClass("progress-bar-success");
      $("#buspic").attr("src", "images/bus-2.png");

    }else if(remaining > 5){
      $("#progressRemain").removeClass("progress-bar-danger");
      $("#progressRemain").addClass("progress-bar-warning");
      $("#buspic").attr("src", "images/bus-3.png");


    }
  }

});

function entering()  {
  if(count<19){
    var x = Math.floor((Math.random() * 19));
    var detect;
    if(count>0){
      for(i=0;i<count;i++){
        if(passenger[i] === x || x === 19)
        {
          detect = true;
          x = Math.floor((Math.random() * 19));
          i = -1;
        }
        else{
          detect = false;
        }
      }
    }
    if(detect === false || count === 0){
      passenger[count] = x;
      seat[passenger[count]].removeClass("btn-success");
      seat[passenger[count]].addClass("disabled");
      list += passenger[count]+" ";
      $("#show").text(list);
      count++;

      $("#remain").text(20-$("#footer").val()-count);
      $("#progressRemain").val(20-$("#footer").val()-count);
      var remaining = 20-$("#footer").val()-count;
      $("#progressRemain").css('width', remaining*5+'%').attr('aria-valuenow', remaining);
      console.log(j++);

      // document.getElementById('#panel-enter-body').innerHTML = j ;
      $('#panel-enter-body').html(j);
      var message = PassengerEnter.val(); //Get message from html element
      var date = new Date();
      var now = date.toUTCString();
      $("#chat-list").append("<li><span class = \"indicator success\"> Enter : "+now +"</span>t</li>");

      if(remaining <= 5){
        $("#progressRemain").removeClass("progress-bar-warning");
        $("#progressRemain").addClass("progress-bar-danger");
        $("#buspic").attr("src", "images/bus-1.png");
      }else if(remaining <= 10){
        $("#progressRemain").removeClass("progress-bar-success");
        $("#progressRemain").addClass("progress-bar-warning");
        $("#buspic").attr("src", "images/bus-3.png");

      }
    }
  }



}

function leaving(){
  var random = Math.floor((Math.random() * passenger.length));
  if(passenger.length > 0){
    seat[passenger[random]].removeClass("disabled");
    seat[passenger[random]].addClass("btn-success");
    passenger.splice(random,1);
    count--;

    $("#remain").text(20-$("#footer").val()-count);
    var remaining = 20-$("#footer").val()-count;
    $("#progressRemain").css('width', remaining*5+'%').attr('aria-valuenow', remaining);
    console.log(k++);
    // document.getElementById('#panel-enter-body').innerHTML = j ;
    $('#panel-leave-body').html(k);
    var message = PassengerEnter.val(); //Get message from html element
    var date = new Date();
    var now = date.toUTCString();
    $("#chat-list").append("<li><span class = \"indicator success\"> Leave : "+now +"</span>t</li>");

    if(remaining > 10){
      $("#progressRemain").removeClass("progress-bar-warning");
      $("#progressRemain").addClass("progress-bar-success");
      $("#buspic").attr("src", "images/bus-2.png");
    }else if(remaining > 5){
      $("#progressRemain").removeClass("progress-bar-danger");
      $("#progressRemain").addClass("progress-bar-warning");
      $("#buspic").attr("src", "images/bus-3.png");

    }

  }
  else {
    alert("No one in a bus");
  }

}


////////////////////rightColumn///////////


/* Linking html to javascript via jQuery*/
var chatList = $('#chat-list');
var SendButton = $('#btn-send');
var PassengerEnter = $('#PassengerEnter');
var currentMessage = '';
var i = 0;
var j =0;
var k = 0;
function checking(i){

  if( i == 1) { //When press Enter
        this.entering();


  }else if (i == 2) {
    this.leaving();

  }
}

setInterval(function() {
  //Run every 1 second (1000 milliseconds)
  $.ajax({
    url: 'http://10.32.176.4/exist'
  })
  .done(function(data) {
    checking(data);
  });
}, 1000);



</script>






</body>

</html>
